{"version":3,"sources":["dog.js","dograin.js","index.js"],"names":["Dog","opts","loaded","alive","x","Math","random","y","rotation","xSpeed","ySpeed","rSpeed","fadeSpeed","container","HTMLElement","document","body","img","Image","src","ceil","style","maxWidth","height","opacity","transition","setPosition","appendChild","onload","show","onloadCallback","callback","console","log","position","left","top","transform","Promise","resolve","reject","setTimeout","deltaTime","parentNode","removeChild","DogRain","isRaining","dogs","limit","speed","minInterval","maxInterval","createElement","width","onclick","stop","window","event","eventShouldTriggerStart","start","node","toElement","classList","contains","startCreationLoop","animate","length","pop","hide","then","dog","cleanUp","push","now","performance","lastFrame","i","kill","splice","requestAnimationFrame","dogRain","init"],"mappings":"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","file":"dograin.js","sourceRoot":"../src","sourcesContent":["export default class Dog {\n  constructor(opts) {\n    opts = opts || {};\n\n    this.loaded = false;\n    this.alive = true;\n\n    this.x = typeof opts.x === \"number\" ? opts.x : 100 * Math.random();\n    this.y = typeof opts.y === \"number\" ? opts.y : 100 * Math.random();\n    this.rotation =\n      typeof opts.rotation === \"number\"\n        ? opts.rotation\n        : 90 * Math.random() - 45;\n    this.xSpeed = typeof opts.xSpeed === \"number\" ? opts.xSpeed : 0;\n    this.ySpeed = typeof opts.ySpeed === \"number\" ? opts.ySpeed : 0;\n    this.rSpeed = typeof opts.rSpeed === \"number\" ? opts.rSpeed : 0;\n    this.fadeSpeed = typeof opts.fadeSpeed === \"number\" ? opts.fadeSpeed : 1000;\n    this.container =\n      opts.container instanceof HTMLElement ? opts.container : document.body;\n\n    this.img = new Image();\n    this.img.src = \"https://placedog.net/\" + Math.ceil(1000 * Math.random());\n\n    this.img.style.maxWidth = \"300px\";\n    this.img.style.height = \"auto\";\n    this.img.style.opacity = 0;\n    this.img.style.transition = \"opacity \" + this.fadeSpeed + \"ms ease-in\";\n\n    this.setPosition(opts.x, opts.y, opts.rotation);\n\n    this.container.appendChild(this.img);\n\n    this.img.onload = () => {\n      this.loaded = true;\n      this.show();\n\n      if (typeof this.onloadCallback === \"function\") {\n        this.onloadCallback(this);\n      }\n    };\n  }\n\n  onload(callback) {\n    this.onloadCallback = callback;\n  }\n\n  setPosition(x, y, rotation) {\n    this.x = typeof x === \"number\" ? x : 100 * Math.random();\n    this.y = typeof y === \"number\" ? y : 100 * Math.random();\n    console.log(rotation);\n    this.rotation =\n      typeof rotation === \"number\" ? rotation : 90 * Math.random() - 45;\n\n    this.img.style.position = \"absolute\";\n    this.img.style.left = this.x + \"%\";\n    this.img.style.top = this.y + \"%\";\n    this.img.style.transform =\n      \"translate(-50%, -50%) rotate(\" + this.rotation + \"deg)\";\n  }\n\n  show() {\n    return new Promise((resolve, reject) => {\n      this.img.style.opacity = 1;\n      setTimeout(() => {\n        resolve(this);\n      }, this.fadeSpeed);\n    });\n  }\n\n  hide() {\n    return new Promise((resolve, reject) => {\n      this.img.style.opacity = 0;\n      setTimeout(() => {\n        resolve(this);\n      }, this.fadeSpeed);\n    });\n  }\n\n  animate(deltaTime) {\n    if (!this.loaded || !this.alive) {\n      return;\n    }\n\n    deltaTime = deltaTime || 0;\n\n    this.setPosition(\n      this.x + this.xSpeed * deltaTime,\n      this.y + this.ySpeed * deltaTime,\n      this.rotation + this.rSpeed * deltaTime\n    );\n  }\n\n  kill() {\n    this.alive = false;\n  }\n\n  cleanUp() {\n    this.img.parentNode.removeChild(this.img);\n  }\n}\n","import Dog from \"./dog\";\n\nexport default class DogRain {\n  constructor() {\n    this.isRaining = false;\n    this.dogs = [];\n    this.limit = 20;\n    this.speed = 0.02;\n    this.minInterval = 200;\n    this.maxInterval = 2000;\n\n    this.container = document.createElement(\"div\");\n    this.container.style.position = \"fixed\";\n    this.container.style.left = 0;\n    this.container.style.top = 0;\n    this.container.style.width = \"100vw\";\n    this.container.style.height = \"100vh\";\n    this.container.onclick = () => {\n      this.stop();\n    };\n  }\n\n  /**\n   * Initialize event handlers\n   */\n  init() {\n    window.onclick = event => {\n      if (this.eventShouldTriggerStart(event)) {\n        this.start();\n      }\n    };\n  }\n\n  /**\n   * Test event element for dograin class\n   * @param UIEvent event\n   * @return boolean  Returns true when target element has class, or false\n   */\n  eventShouldTriggerStart(event) {\n    let node = event.toElement;\n\n    do {\n      // look for dograin class\n      if (node.classList.contains(\"dograin\")) {\n        return true;\n      }\n\n      // climb up to parent\n      node = node.parentNode;\n    } while (node instanceof HTMLElement && node.parentNode);\n\n    return false;\n  }\n\n  /**\n   * Make it rain... Dogs!\n   */\n  start() {\n    document.body.appendChild(this.container);\n\n    if (this.isRaining) {\n      return this.stop();\n    }\n\n    this.isRaining = true;\n\n    this.startCreationLoop();\n    this.animate();\n  }\n\n  /**\n   * Stop the rain... :(\n   */\n  stop() {\n    this.isRaining = false;\n\n    while (this.dogs.length > 0) {\n      this.dogs\n        .pop()\n        .hide()\n        .then(dog => {\n          dog.cleanUp();\n        });\n    }\n\n    document.body.removeChild(this.container);\n  }\n\n  startCreationLoop() {\n    // stop creating if not raining\n    if (!this.isRaining) {\n      return;\n    }\n\n    if (this.dogs.length < this.limit) {\n      this.dogs.push(\n        new Dog({\n          x: 100 * Math.random(),\n          y: 0,\n          ySpeed: this.speed,\n          rSpeed: 0,\n          container: this.container\n        })\n      );\n    }\n\n    setTimeout(() => {\n      this.startCreationLoop();\n    }, this.minInterval + (this.maxInterval - this.minInterval) * Math.random());\n  }\n\n  animate(now) {\n    if (!this.isRaining) {\n      return;\n    }\n\n    now = now || performance.now();\n    const deltaTime = this.lastFrame ? now - this.lastFrame : 0;\n    this.lastFrame = now;\n\n    for (let i in this.dogs) {\n      let dog = this.dogs[i];\n\n      // Remove dog from DOM\n      if (!dog.alive) {\n        dog.cleanUp();\n        this.dogs.splice(i, 1);\n        continue;\n      }\n\n      if (dog.y > 100) {\n        dog.hide().then(dog => {\n          dog.kill();\n        });\n      }\n      dog.animate(deltaTime);\n    }\n\n    window.requestAnimationFrame(now => this.animate(now));\n  }\n}\n","import DogRain from './dograin'\n\n(window.dogRain = new DogRain()).init()"]}